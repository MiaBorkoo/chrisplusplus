{
    "openapi": "3.1.0",
    "info": {
      "title": "EPIC Server",
      "description": "Server for CS4455 Epic Project",
      "version": "0.1.0"
    },
    "paths": {
      "/api/auth/register": {
        "post": {
          "tags": [
            "Authentication"
          ],
          "summary": "Register User",
          "operationId": "register_user_api_auth_register_post",
          "requestBody": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/RegisterRequest"
                }
              }
            },
            "required": true
          },
          "responses": {
            "200": {
              "description": "Successful Response",
              "content": {
                "application/json": {
                  "schema": {
  
                  }
                }
              }
            },
            "422": {
              "description": "Validation Error",
              "content": {
                "application/json": {
                  "schema": {
                    "$ref": "#/components/schemas/HTTPValidationError"
                  }
                }
              }
            }
          }
        }
      },
      "/api/auth/login": {
        "post": {
          "tags": [
            "Authentication"
          ],
          "summary": "Login",
          "operationId": "login_api_auth_login_post",
          "requestBody": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/LoginRequest"
                }
              }
            },
            "required": true
          },
          "responses": {
            "200": {
              "description": "Successful Response",
              "content": {
                "application/json": {
                  "schema": {
  
                  }
                }
              }
            },
            "422": {
              "description": "Validation Error",
              "content": {
                "application/json": {
                  "schema": {
                    "$ref": "#/components/schemas/HTTPValidationError"
                  }
                }
              }
            }
          }
        }
      },
      "/api/auth/totp": {
        "post": {
          "tags": [
            "Authentication"
          ],
          "summary": "Verify Totp And Return Mek",
          "operationId": "verify_totp_and_return_mek_api_auth_totp_post",
          "requestBody": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/TOTPRequest"
                }
              }
            },
            "required": true
          },
          "responses": {
            "200": {
              "description": "Successful Response",
              "content": {
                "application/json": {
                  "schema": {
  
                  }
                }
              }
            },
            "422": {
              "description": "Validation Error",
              "content": {
                "application/json": {
                  "schema": {
                    "$ref": "#/components/schemas/HTTPValidationError"
                  }
                }
              }
            }
          }
        }
      },
      "/api/auth/logout": {
        "post": {
          "tags": [
            "Authentication"
          ],
          "summary": "Logout",
          "description": "Logout user by invalidating session token",
          "operationId": "logout_api_auth_logout_post",
          "responses": {
            "200": {
              "description": "Successful Response",
              "content": {
                "application/json": {
                  "schema": {
  
                  }
                }
              }
            }
          }
        }
      },
      "/api/auth/change_password": {
        "post": {
          "tags": [
            "Authentication"
          ],
          "summary": "Change Password",
          "operationId": "change_password_api_auth_change_password_post",
          "requestBody": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ChangePasswordRequest"
                }
              }
            },
            "required": true
          },
          "responses": {
            "200": {
              "description": "Successful Response",
              "content": {
                "application/json": {
                  "schema": {
  
                  }
                }
              }
            },
            "422": {
              "description": "Validation Error",
              "content": {
                "application/json": {
                  "schema": {
                    "$ref": "#/components/schemas/HTTPValidationError"
                  }
                }
              }
            }
          }
        }
      },
      "/api/files/upload": {
        "post": {
          "tags": [
            "Files"
          ],
          "summary": "Upload File",
          "description": "Upload a file with integrity protection and audit logging",
          "operationId": "upload_file_api_files_upload_post",
          "requestBody": {
            "content": {
              "multipart/form-data": {
                "schema": {
                  "$ref": "#/components/schemas/Body_upload_file_api_files_upload_post"
                }
              }
            },
            "required": true
          },
          "responses": {
            "200": {
              "description": "Successful Response",
              "content": {
                "application/json": {
                  "schema": {
                    "additionalProperties": true,
                    "type": "object",
                    "title": "Response Upload File Api Files Upload Post"
                  }
                }
              }
            },
            "422": {
              "description": "Validation Error",
              "content": {
                "application/json": {
                  "schema": {
                    "$ref": "#/components/schemas/HTTPValidationError"
                  }
                }
              }
            }
          },
          "security": [
            {
              "HTTPBearer": []
            }
          ]
        }
      },
      "/api/files/{file_id}/download": {
        "get": {
          "tags": [
            "Files"
          ],
          "summary": "Download File",
          "description": "Download file with authorization check and audit logging",
          "operationId": "download_file_api_files__file_id__download_get",
          "security": [
            {
              "HTTPBearer": []
            }
          ],
          "parameters": [
            {
              "name": "file_id",
              "in": "path",
              "required": true,
              "schema": {
                "type": "string",
                "format": "uuid",
                "title": "File Id"
              }
            }
          ],
          "responses": {
            "200": {
              "description": "Successful Response",
              "content": {
                "application/json": {
                  "schema": {
  
                  }
                }
              }
            },
            "422": {
              "description": "Validation Error",
              "content": {
                "application/json": {
                  "schema": {
                    "$ref": "#/components/schemas/HTTPValidationError"
                  }
                }
              }
            }
          }
        }
      },
      "/api/files/{file_id}/metadata": {
        "get": {
          "tags": [
            "Files"
          ],
          "summary": "Get File Metadata",
          "description": "Get file metadata",
          "operationId": "get_file_metadata_api_files__file_id__metadata_get",
          "security": [
            {
              "HTTPBearer": []
            }
          ],
          "parameters": [
            {
              "name": "file_id",
              "in": "path",
              "required": true,
              "schema": {
                "type": "string",
                "format": "uuid",
                "title": "File Id"
              }
            }
          ],
          "responses": {
            "200": {
              "description": "Successful Response",
              "content": {
                "application/json": {
                  "schema": {
  
                  }
                }
              }
            },
            "422": {
              "description": "Validation Error",
              "content": {
                "application/json": {
                  "schema": {
                    "$ref": "#/components/schemas/HTTPValidationError"
                  }
                }
              }
            }
          }
        }
      },
      "/api/files/share": {
        "post": {
          "tags": [
            "Files"
          ],
          "summary": "Share File",
          "description": "Share a file with another user with integrity protection",
          "operationId": "share_file_api_files_share_post",
          "requestBody": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/FileShareRequest"
                }
              }
            },
            "required": true
          },
          "responses": {
            "200": {
              "description": "Successful Response",
              "content": {
                "application/json": {
                  "schema": {
                    "additionalProperties": true,
                    "type": "object",
                    "title": "Response Share File Api Files Share Post"
                  }
                }
              }
            },
            "422": {
              "description": "Validation Error",
              "content": {
                "application/json": {
                  "schema": {
                    "$ref": "#/components/schemas/HTTPValidationError"
                  }
                }
              }
            }
          },
          "security": [
            {
              "HTTPBearer": []
            }
          ]
        }
      },
      "/api/files/share/{share_id}": {
        "delete": {
          "tags": [
            "Files"
          ],
          "summary": "Revoke Share",
          "description": "Revoke a file share",
          "operationId": "revoke_share_api_files_share__share_id__delete",
          "security": [
            {
              "HTTPBearer": []
            }
          ],
          "parameters": [
            {
              "name": "share_id",
              "in": "path",
              "required": true,
              "schema": {
                "type": "string",
                "format": "uuid",
                "title": "Share Id"
              }
            }
          ],
          "responses": {
            "200": {
              "description": "Successful Response",
              "content": {
                "application/json": {
                  "schema": {
                    "type": "object",
                    "additionalProperties": true,
                    "title": "Response Revoke Share Api Files Share  Share Id  Delete"
                  }
                }
              }
            },
            "422": {
              "description": "Validation Error",
              "content": {
                "application/json": {
                  "schema": {
                    "$ref": "#/components/schemas/HTTPValidationError"
                  }
                }
              }
            }
          }
        }
      },
      "/api/files/": {
        "get": {
          "tags": [
            "Files"
          ],
          "summary": "List Files",
          "description": "List user's owned and shared files with pagination",
          "operationId": "list_files_api_files__get",
          "security": [
            {
              "HTTPBearer": []
            }
          ],
          "parameters": [
            {
              "name": "limit",
              "in": "query",
              "required": false,
              "schema": {
                "type": "integer",
                "maximum": 100,
                "minimum": 1,
                "default": 50,
                "title": "Limit"
              }
            },
            {
              "name": "offset",
              "in": "query",
              "required": false,
              "schema": {
                "type": "integer",
                "minimum": 0,
                "default": 0,
                "title": "Offset"
              }
            }
          ],
          "responses": {
            "200": {
              "description": "Successful Response",
              "content": {
                "application/json": {
                  "schema": {
                    "$ref": "#/components/schemas/UserFilesResponse"
                  }
                }
              }
            },
            "422": {
              "description": "Validation Error",
              "content": {
                "application/json": {
                  "schema": {
                    "$ref": "#/components/schemas/HTTPValidationError"
                  }
                }
              }
            }
          }
        }
      },
      "/api/files/{file_id}/shares": {
        "get": {
          "tags": [
            "Files"
          ],
          "summary": "List File Shares",
          "description": "List all shares for a file (only owner can view)",
          "operationId": "list_file_shares_api_files__file_id__shares_get",
          "security": [
            {
              "HTTPBearer": []
            }
          ],
          "parameters": [
            {
              "name": "file_id",
              "in": "path",
              "required": true,
              "schema": {
                "type": "string",
                "format": "uuid",
                "title": "File Id"
              }
            }
          ],
          "responses": {
            "200": {
              "description": "Successful Response",
              "content": {
                "application/json": {
                  "schema": {
                    "type": "array",
                    "items": {
                      "$ref": "#/components/schemas/ShareResponse"
                    },
                    "title": "Response List File Shares Api Files  File Id  Shares Get"
                  }
                }
              }
            },
            "422": {
              "description": "Validation Error",
              "content": {
                "application/json": {
                  "schema": {
                    "$ref": "#/components/schemas/HTTPValidationError"
                  }
                }
              }
            }
          }
        }
      },
      "/api/files/shares/received": {
        "get": {
          "tags": [
            "Files"
          ],
          "summary": "List Received Shares",
          "description": "List files shared with current user",
          "operationId": "list_received_shares_api_files_shares_received_get",
          "security": [
            {
              "HTTPBearer": []
            }
          ],
          "parameters": [
            {
              "name": "limit",
              "in": "query",
              "required": false,
              "schema": {
                "type": "integer",
                "maximum": 100,
                "minimum": 1,
                "default": 50,
                "title": "Limit"
              }
            },
            {
              "name": "offset",
              "in": "query",
              "required": false,
              "schema": {
                "type": "integer",
                "minimum": 0,
                "default": 0,
                "title": "Offset"
              }
            }
          ],
          "responses": {
            "200": {
              "description": "Successful Response",
              "content": {
                "application/json": {
                  "schema": {
                    "type": "array",
                    "items": {
                      "$ref": "#/components/schemas/SharedFileResponse"
                    },
                    "title": "Response List Received Shares Api Files Shares Received Get"
                  }
                }
              }
            },
            "422": {
              "description": "Validation Error",
              "content": {
                "application/json": {
                  "schema": {
                    "$ref": "#/components/schemas/HTTPValidationError"
                  }
                }
              }
            }
          }
        }
      },
      "/api/files/{file_id}/audit": {
        "get": {
          "tags": [
            "Files"
          ],
          "summary": "Get File Audit Logs",
          "description": "Get audit logs for a file (only owner can view)",
          "operationId": "get_file_audit_logs_api_files__file_id__audit_get",
          "security": [
            {
              "HTTPBearer": []
            }
          ],
          "parameters": [
            {
              "name": "file_id",
              "in": "path",
              "required": true,
              "schema": {
                "type": "string",
                "format": "uuid",
                "title": "File Id"
              }
            },
            {
              "name": "limit",
              "in": "query",
              "required": false,
              "schema": {
                "type": "integer",
                "maximum": 100,
                "minimum": 1,
                "default": 50,
                "title": "Limit"
              }
            },
            {
              "name": "offset",
              "in": "query",
              "required": false,
              "schema": {
                "type": "integer",
                "minimum": 0,
                "default": 0,
                "title": "Offset"
              }
            }
          ],
          "responses": {
            "200": {
              "description": "Successful Response",
              "content": {
                "application/json": {
                  "schema": {
                    "type": "array",
                    "items": {
                      "$ref": "#/components/schemas/AuditLogResponse"
                    },
                    "title": "Response Get File Audit Logs Api Files  File Id  Audit Get"
                  }
                }
              }
            },
            "422": {
              "description": "Validation Error",
              "content": {
                "application/json": {
                  "schema": {
                    "$ref": "#/components/schemas/HTTPValidationError"
                  }
                }
              }
            }
          }
        }
      },
      "/api/files/delete": {
        "delete": {
          "tags": [
            "Files"
          ],
          "summary": "Delete File",
          "description": "Delete a file permanently (only owner can delete)",
          "operationId": "delete_file_api_files_delete_delete",
          "requestBody": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/FileDeleteRequest"
                }
              }
            },
            "required": true
          },
          "responses": {
            "200": {
              "description": "Successful Response",
              "content": {
                "application/json": {
                  "schema": {
                    "additionalProperties": true,
                    "type": "object",
                    "title": "Response Delete File Api Files Delete Delete"
                  }
                }
              }
            },
            "422": {
              "description": "Validation Error",
              "content": {
                "application/json": {
                  "schema": {
                    "$ref": "#/components/schemas/HTTPValidationError"
                  }
                }
              }
            }
          },
          "security": [
            {
              "HTTPBearer": []
            }
          ]
        }
      },
      "/api/user/{username}/salts": {
        "get": {
          "tags": [
            "User"
          ],
          "summary": "Get Salts",
          "operationId": "get_salts_api_user__username__salts_get",
          "parameters": [
            {
              "name": "username",
              "in": "path",
              "required": true,
              "schema": {
                "type": "string",
                "title": "Username"
              }
            }
          ],
          "responses": {
            "200": {
              "description": "Successful Response",
              "content": {
                "application/json": {
                  "schema": {
                    "$ref": "#/components/schemas/UserSaltsResponse"
                  }
                }
              }
            },
            "422": {
              "description": "Validation Error",
              "content": {
                "application/json": {
                  "schema": {
                    "$ref": "#/components/schemas/HTTPValidationError"
                  }
                }
              }
            }
          }
        }
      },
      "/": {
        "get": {
          "summary": "Root",
          "operationId": "root__get",
          "responses": {
            "200": {
              "description": "Successful Response",
              "content": {
                "application/json": {
                  "schema": {
  
                  }
                }
              }
            }
          }
        }
      }
    },
    "components": {
      "schemas": {
        "AuditLogResponse": {
          "properties": {
            "log_id": {
              "type": "string",
              "format": "uuid",
              "title": "Log Id"
            },
            "action": {
              "type": "string",
              "title": "Action"
            },
            "timestamp": {
              "type": "integer",
              "title": "Timestamp"
            },
            "client_ip_hash": {
              "type": "string",
              "title": "Client Ip Hash"
            }
          },
          "type": "object",
          "required": [
            "log_id",
            "action",
            "timestamp",
            "client_ip_hash"
          ],
          "title": "AuditLogResponse"
        },
        "Body_upload_file_api_files_upload_post": {
          "properties": {
            "file": {
              "type": "string",
              "format": "binary",
              "title": "File"
            },
            "file_id": {
              "type": "string",
              "title": "File Id"
            },
            "filename_encrypted": {
              "type": "string",
              "title": "Filename Encrypted"
            },
            "file_size_encrypted": {
              "type": "string",
              "title": "File Size Encrypted"
            },
            "file_data_hmac": {
              "type": "string",
              "title": "File Data Hmac"
            }
          },
          "type": "object",
          "required": [
            "file",
            "filename_encrypted",
            "file_size_encrypted",
            "file_data_hmac"
          ],
          "title": "Body_upload_file_api_files_upload_post"
        },
        "ChangePasswordRequest": {
          "properties": {
            "username": {
              "type": "string",
              "title": "Username"
            },
            "old_auth_key": {
              "type": "string",
              "title": "Old Auth Key"
            },
            "new_auth_key": {
              "type": "string",
              "title": "New Auth Key"
            },
            "new_encrypted_mek": {
              "type": "string",
              "title": "New Encrypted Mek"
            },
            "totp_code": {
              "type": "string",
              "title": "Totp Code"
            }
          },
          "type": "object",
          "required": [
            "username",
            "old_auth_key",
            "new_auth_key",
            "new_encrypted_mek",
            "totp_code"
          ],
          "title": "ChangePasswordRequest"
        },
        "FileDeleteRequest": {
          "properties": {
            "file_id": {
              "type": "string",
              "format": "uuid",
              "title": "File Id"
            }
          },
          "type": "object",
          "required": [
            "file_id"
          ],
          "title": "FileDeleteRequest"
        },
        "FileResponse": {
          "properties": {
            "file_id": {
              "type": "string",
              "format": "uuid",
              "title": "File Id"
            },
            "filename_encrypted": {
              "type": "string",
              "format": "binary",
              "title": "Filename Encrypted"
            },
            "file_size_encrypted": {
              "type": "string",
              "format": "binary",
              "title": "File Size Encrypted"
            },
            "upload_timestamp": {
              "type": "integer",
              "title": "Upload Timestamp"
            },
            "file_data_hmac": {
              "type": "string",
              "title": "File Data Hmac"
            },
            "server_storage_path": {
              "type": "string",
              "title": "Server Storage Path"
            }
          },
          "type": "object",
          "required": [
            "file_id",
            "filename_encrypted",
            "file_size_encrypted",
            "upload_timestamp",
            "file_data_hmac",
            "server_storage_path"
          ],
          "title": "FileResponse"
        },
        "FileShareRequest": {
          "properties": {
            "file_id": {
              "type": "string",
              "format": "uuid",
              "title": "File Id"
            },
            "recipient_username": {
              "type": "string",
              "maxLength": 255,
              "title": "Recipient Username"
            },
            "encrypted_data_key": {
              "type": "string",
              "format": "binary",
              "title": "Encrypted Data Key"
            },
            "expires_at": {
              "anyOf": [
                {
                  "type": "string",
                  "format": "date-time"
                },
                {
                  "type": "null"
                }
              ],
              "title": "Expires At"
            },
            "share_grant_hmac": {
              "type": "string",
              "maxLength": 64,
              "title": "Share Grant Hmac"
            },
            "share_chain_hmac": {
              "type": "string",
              "maxLength": 64,
              "title": "Share Chain Hmac"
            }
          },
          "type": "object",
          "required": [
            "file_id",
            "recipient_username",
            "encrypted_data_key",
            "share_grant_hmac",
            "share_chain_hmac"
          ],
          "title": "FileShareRequest"
        },
        "HTTPValidationError": {
          "properties": {
            "detail": {
              "items": {
                "$ref": "#/components/schemas/ValidationError"
              },
              "type": "array",
              "title": "Detail"
            }
          },
          "type": "object",
          "title": "HTTPValidationError"
        },
        "LoginRequest": {
          "properties": {
            "username": {
              "type": "string",
              "title": "Username"
            },
            "auth_key": {
              "type": "string",
              "title": "Auth Key"
            }
          },
          "type": "object",
          "required": [
            "username",
            "auth_key"
          ],
          "title": "LoginRequest"
        },
        "RegisterRequest": {
          "properties": {
            "username": {
              "type": "string",
              "title": "Username"
            },
            "auth_salt": {
              "type": "string",
              "title": "Auth Salt"
            },
            "enc_salt": {
              "type": "string",
              "title": "Enc Salt"
            },
            "auth_key": {
              "type": "string",
              "title": "Auth Key"
            },
            "encrypted_mek": {
              "type": "string",
              "title": "Encrypted Mek"
            },
            "totp_secret": {
              "type": "string",
              "title": "Totp Secret"
            },
            "public_key": {
              "additionalProperties": true,
              "type": "object",
              "title": "Public Key"
            },
            "user_data_hmac": {
              "type": "string",
              "title": "User Data Hmac"
            }
          },
          "type": "object",
          "required": [
            "username",
            "auth_salt",
            "enc_salt",
            "auth_key",
            "encrypted_mek",
            "totp_secret",
            "public_key",
            "user_data_hmac"
          ],
          "title": "RegisterRequest"
        },
        "ShareResponse": {
          "properties": {
            "share_id": {
              "type": "string",
              "format": "uuid",
              "title": "Share Id"
            },
            "file_id": {
              "type": "string",
              "format": "uuid",
              "title": "File Id"
            },
            "recipient_id": {
              "type": "string",
              "format": "uuid",
              "title": "Recipient Id"
            },
            "granted_at": {
              "type": "string",
              "format": "date-time",
              "title": "Granted At"
            },
            "expires_at": {
              "anyOf": [
                {
                  "type": "string",
                  "format": "date-time"
                },
                {
                  "type": "null"
                }
              ],
              "title": "Expires At"
            },
            "revoked_at": {
              "anyOf": [
                {
                  "type": "string",
                  "format": "date-time"
                },
                {
                  "type": "null"
                }
              ],
              "title": "Revoked At"
            }
          },
          "type": "object",
          "required": [
            "share_id",
            "file_id",
            "recipient_id",
            "granted_at",
            "expires_at",
            "revoked_at"
          ],
          "title": "ShareResponse"
        },
        "SharedFileResponse": {
          "properties": {
            "file_id": {
              "type": "string",
              "format": "uuid",
              "title": "File Id"
            },
            "filename_encrypted": {
              "type": "string",
              "format": "binary",
              "title": "Filename Encrypted"
            },
            "file_size_encrypted": {
              "type": "string",
              "format": "binary",
              "title": "File Size Encrypted"
            },
            "upload_timestamp": {
              "type": "integer",
              "title": "Upload Timestamp"
            },
            "file_data_hmac": {
              "type": "string",
              "title": "File Data Hmac"
            },
            "share_id": {
              "type": "string",
              "format": "uuid",
              "title": "Share Id"
            }
          },
          "type": "object",
          "required": [
            "file_id",
            "filename_encrypted",
            "file_size_encrypted",
            "upload_timestamp",
            "file_data_hmac",
            "share_id"
          ],
          "title": "SharedFileResponse"
        },
        "TOTPRequest": {
          "properties": {
            "username": {
              "type": "string",
              "title": "Username"
            },
            "totp_code": {
              "type": "string",
              "title": "Totp Code"
            }
          },
          "type": "object",
          "required": [
            "username",
            "totp_code"
          ],
          "title": "TOTPRequest"
        },
        "UserFilesResponse": {
          "properties": {
            "owned_files": {
              "items": {
                "$ref": "#/components/schemas/FileResponse"
              },
              "type": "array",
              "title": "Owned Files"
            },
            "shared_files": {
              "items": {
                "$ref": "#/components/schemas/SharedFileResponse"
              },
              "type": "array",
              "title": "Shared Files"
            }
          },
          "type": "object",
          "required": [
            "owned_files",
            "shared_files"
          ],
          "title": "UserFilesResponse"
        },
        "UserSaltsResponse": {
          "properties": {
            "auth_salt": {
              "type": "string",
              "title": "Auth Salt"
            },
            "enc_salt": {
              "type": "string",
              "title": "Enc Salt"
            }
          },
          "type": "object",
          "required": [
            "auth_salt",
            "enc_salt"
          ],
          "title": "UserSaltsResponse"
        },
        "ValidationError": {
          "properties": {
            "loc": {
              "items": {
                "anyOf": [
                  {
                    "type": "string"
                  },
                  {
                    "type": "integer"
                  }
                ]
              },
              "type": "array",
              "title": "Location"
            },
            "msg": {
              "type": "string",
              "title": "Message"
            },
            "type": {
              "type": "string",
              "title": "Error Type"
            }
          },
          "type": "object",
          "required": [
            "loc",
            "msg",
            "type"
          ],
          "title": "ValidationError"
        }
      },
      "securitySchemes": {
        "HTTPBearer": {
          "type": "http",
          "scheme": "bearer"
        }
      }
    }
  }